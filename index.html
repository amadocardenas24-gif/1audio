<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Experiencia AR con Audio - Foz do Igua√ßu</title>
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>
    
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            overflow: hidden;
        }
        
        /* Pantalla de inicio mejorada */
        #ui-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #1a2980 0%, #26d0ce 100%);
            z-index: 9999;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            color: white;
            text-align: center;
            padding: 20px;
        }
        
        .logo-container {
            margin-bottom: 30px;
        }
        
        .logo {
            font-size: 80px;
            margin-bottom: 10px;
        }
        
        h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .subtitle {
            font-size: 1.2em;
            margin-bottom: 40px;
            opacity: 0.9;
            max-width: 600px;
        }
        
        /* Bot√≥n de inicio mejorado */
        #start-btn {
            padding: 20px 50px;
            font-size: 1.3em;
            font-weight: bold;
            cursor: pointer;
            background: linear-gradient(to right, #FF6B6B, #FF8E53);
            color: white;
            border: none;
            border-radius: 50px;
            box-shadow: 0 10px 20px rgba(255, 107, 107, 0.3);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        #start-btn:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 25px rgba(255, 107, 107, 0.4);
        }
        
        #start-btn:active {
            transform: translateY(-2px);
        }
        
        .btn-icon {
            font-size: 1.5em;
        }
        
        /* Indicadores de estado */
        #status-indicator {
            position: fixed;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 15px 30px;
            border-radius: 50px;
            z-index: 9998;
            display: none;
            align-items: center;
            gap: 10px;
            font-size: 1.1em;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        #status-message {
            font-weight: 500;
        }
        
        .status-icon {
            font-size: 1.3em;
        }
        
        /* Instrucciones */
        .instructions {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 25px;
            margin-top: 30px;
            max-width: 500px;
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .instructions h3 {
            margin-top: 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .instructions ul {
            text-align: left;
            margin: 20px 0;
            padding-left: 20px;
        }
        
        .instructions li {
            margin-bottom: 10px;
            opacity: 0.9;
        }
        
        /* Error overlay */
        #error-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 10000;
            display: none;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            color: white;
            text-align: center;
            padding: 20px;
        }
        
        .error-icon {
            font-size: 4em;
            color: #FF6B6B;
            margin-bottom: 20px;
        }
        
        .error-actions {
            margin-top: 30px;
            display: flex;
            gap: 15px;
        }
        
        .error-btn {
            padding: 12px 25px;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
        }
    </style>
</head>

<body>
    <!-- Pantalla de inicio mejorada -->
    <div id="ui-overlay">
        <div class="logo-container">
            <div class="logo">üîä</div>
            <h1>EXPERIENCIA AR CON SONIDO</h1>
            <p class="subtitle">Sum√©rgete en una experiencia inmersiva de realidad aumentada con audio de Foz do Igua√ßu, Brasil</p>
        </div>
        
        <button id="start-btn">
            <span class="btn-icon">‚ñ∂Ô∏è</span>
            <span>INICIAR EXPERIENCIA CON SONIDO</span>
        </button>
        
        <div class="instructions">
            <h3><span>üìã</span> C√ìMO USAR</h3>
            <ul>
                <li>1. Haz clic en el bot√≥n "INICIAR EXPERIENCIA"</li>
                <li>2. Permite el acceso a la c√°mara cuando se solicite</li>
                <li>3. Enfoca la c√°mara hacia el marcador tur√≠stico</li>
                <li>4. El video con audio comenzar√° autom√°ticamente</li>
                <li>5. Aleja el marcador para pausar el video</li>
            </ul>
            <p><strong>Nota:</strong> Aseg√∫rate de que el volumen de tu dispositivo est√© activado.</p>
        </div>
    </div>

    <!-- Indicador de estado -->
    <div id="status-indicator">
        <span class="status-icon">üéØ</span>
        <span id="status-message">Buscando marcador...</span>
    </div>

    <!-- Overlay de error -->
    <div id="error-overlay">
        <div class="error-icon">‚ö†Ô∏è</div>
        <h2>Error al cargar la experiencia</h2>
        <p id="error-details">No se pudieron cargar los recursos necesarios.</p>
        <div class="error-actions">
            <button class="error-btn" onclick="location.reload()">Reintentar</button>
            <button class="error-btn" onclick="showTroubleshooting()">Soluci√≥n de problemas</button>
        </div>
    </div>

    <!-- Escena AR -->
    <a-scene mindar-image="imageTargetSrc: ./marker.mind;" 
             vr-mode-ui="enabled: false" 
             device-orientation-permission-ui="enabled: false"
             id="ar-scene"
             style="opacity: 0; transition: opacity 1s ease;">
        
        <a-assets>
            <video id="ar-video" 
                   src="./asset.mp4" 
                   loop 
                   playsinline 
                   crossorigin="anonymous"
                   preload="auto">
            </video>
        </a-assets>

        <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>

        <a-entity id="ar-target" mindar-image-target="targetIndex: 0">
            <!-- Video con proporci√≥n 16:9 (1.8 x 1.0) -->
            <a-video src="#ar-video" 
                     width="1.8" 
                     height="1" 
                     position="0 0 0"
                     material="shader: flat; side: double">
            </a-video>
            
            <!-- Marco decorativo sutil -->
            <a-plane src="#ar-video"
                     width="1.85" 
                     height="1.05" 
                     position="0 0 -0.01"
                     material="color: #000000; opacity: 0.3; side: double">
            </a-plane>
        </a-entity>
    </a-scene>

    <script>
        // Elementos del DOM
        const startBtn = document.querySelector('#start-btn');
        const overlay = document.querySelector('#ui-overlay');
        const statusIndicator = document.querySelector('#status-indicator');
        const statusMessage = document.querySelector('#status-message');
        const statusIcon = document.querySelector('.status-icon');
        const errorOverlay = document.querySelector('#error-overlay');
        const errorDetails = document.querySelector('#error-details');
        const video = document.querySelector('#ar-video');
        const arTarget = document.querySelector('#ar-target');
        const arScene = document.querySelector('#ar-scene');

        // Estado de la experiencia
        let experienceStarted = false;
        let targetDetected = false;

        // 1. Iniciar experiencia con sonido
        startBtn.addEventListener('click', async () => {
            try {
                console.log("üîä Iniciando experiencia con audio...");
                
                // Intentar activar audio
                await video.play();
                await video.pause();
                
                console.log("‚úÖ Audio activado correctamente");
                
                // Ocultar overlay de inicio
                overlay.style.display = 'none';
                
                // Mostrar escena AR con efecto de fade-in
                arScene.style.opacity = '1';
                
                // Mostrar indicador de estado
                statusIndicator.style.display = 'flex';
                statusMessage.textContent = "üéØ Buscando marcador...";
                statusIcon.textContent = "üéØ";
                
                experienceStarted = true;
                
                // Verificar si los recursos est√°n disponibles
                checkResources();
                
            } catch (error) {
                console.error("‚ùå Error al iniciar audio:", error);
                showError("No se pudo activar el audio. Aseg√∫rate de que tu navegador permita la reproducci√≥n autom√°tica.");
            }
        });

        // 2. Control del video al detectar la imagen (con retardo de 1 segundo)
        arTarget.addEventListener('targetFound', () => {
            if (!targetDetected && experienceStarted) {
                targetDetected = true;
                
                // Actualizar indicador de estado
                statusMessage.textContent = "‚úÖ Marcador detectado";
                statusIcon.textContent = "‚úÖ";
                statusIndicator.style.background = "rgba(46, 204, 113, 0.9)";
                
                // Reproducir con retardo de 1 segundo
                setTimeout(() => {
                    video.play().then(() => {
                        console.log("‚ñ∂Ô∏è Video con audio reproduci√©ndose");
                    }).catch(error => {
                        console.error("‚ùå Error al reproducir video:", error);
                        showError("Error al reproducir el video con audio.");
                    });
                }, 1000);
            }
        });

        arTarget.addEventListener('targetLost', () => {
            if (targetDetected) {
                targetDetected = false;
                
                // Actualizar indicador de estado
                statusMessage.textContent = "üéØ Buscando marcador...";
                statusIcon.textContent = "üéØ";
                statusIndicator.style.background = "rgba(0, 0, 0, 0.8)";
                
                // Pausar video
                video.pause();
                console.log("‚è∏Ô∏è Video pausado");
            }
        });

        // 3. Verificar recursos disponibles
        function checkResources() {
            const resources = [
                { url: './marker.mind', name: 'Archivo de marcador' },
                { url: './asset.mp4', name: 'Video AR' }
            ];
            
            let missingResources = [];
            
            resources.forEach(resource => {
                fetch(resource.url, { method: 'HEAD' })
                    .then(response => {
                        if (!response.ok) {
                            missingResources.push(resource.name);
                        }
                    })
                    .catch(() => {
                        missingResources.push(resource.name);
                    });
            });
            
            // Verificar despu√©s de 2 segundos
            setTimeout(() => {
                if (missingResources.length > 0) {
                    showError(`Faltan recursos: ${missingResources.join(', ')}. Aseg√∫rate de subirlos a GitHub.`);
                }
            }, 2000);
        }

        // 4. Mostrar errores
        function showError(message) {
            errorDetails.textContent = message;
            errorOverlay.style.display = 'flex';
            statusIndicator.style.display = 'none';
        }

        // 5. Soluci√≥n de problemas
        function showTroubleshooting() {
            const troubleshooting = `
                <h3>Soluci√≥n de Problemas</h3>
                <ol>
                    <li><strong>Faltan archivos:</strong> Aseg√∫rate de tener:
                        <ul>
                            <li><code>marker.mind</code> (generado con MindAR Compiler)</li>
                            <li><code>asset.mp4</code> (video con audio)</li>
                        </ul>
                    </li>
                    <li><strong>Generar marcador:</strong> Ve a <a href="https://hiukim.github.io/mind-ar-js-doc/tools/compile/" target="_blank">MindAR Compiler</a> y sube tu imagen.</li>
                    <li><strong>Audio no funciona:</strong> Haz clic en cualquier parte de la p√°gina y luego en el bot√≥n de inicio.</li>
                    <li><strong>No detecta marcador:</strong> Usa buena iluminaci√≥n y mant√©n estable la c√°mara.</li>
                </ol>
                <p><a href="https://github.com/amadocardenas24-gif/amadocardenas24-gif.github.io" target="_blank">üîó Ver tu repositorio GitHub</a></p>
            `;
            
            errorDetails.innerHTML = troubleshooting;
        }

        // 6. Detectar si es m√≥vil para ajustes espec√≠ficos
        const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
        if (isMobile) {
            console.log("üì± Dispositivo m√≥vil detectado");
            // Ajustes espec√≠ficos para m√≥viles si son necesarios
        }

        // 7. Atajos de teclado para desarrollo
        document.addEventListener('keydown', (e) => {
            // R para recargar
            if (e.key === 'r' || e.key === 'R') {
                location.reload();
            }
            // D para simular detecci√≥n (solo desarrollo)
            if (e.key === 'd' || e.key === 'D') {
                console.log("üîß Simulando detecci√≥n (modo desarrollo)");
                arTarget.dispatchEvent(new Event('targetFound'));
            }
        });
    </script>
</body>
</html>

<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>AR Video Experience - Tropical AR</title>
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Arial Rounded MT Bold', 'Arial', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }

        html, body {
            width: 100%;
            height: 100%;
            overflow: hidden;
            position: fixed;
            background: #000;
        }

        /* Pantalla de carga - FIXED para m√≥vil */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            height: -webkit-fill-available; /* Para Safari iOS */
            height: fill-available;
            min-height: 100vh;
            min-height: -webkit-fill-available;
            background: linear-gradient(135deg, #FF6B6B 0%, #FFE66D 25%, #4ECDC4 50%, #1A535C 75%, #FF6B6B 100%);
            background-size: 400% 400%;
            animation: gradientBG 8s ease infinite;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            transition: opacity 1s ease;
            padding: 20px;
            overflow: hidden;
        }

        /* Contenedor de contenido con scroll si es necesario */
        .loading-content {
            text-align: center;
            padding: 20px;
            width: 100%;
            max-width: 500px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        /* Ajustes para m√≥vil */
        @media (max-width: 768px) {
            .loading-title {
                font-size: 2.2rem !important;
                margin-bottom: 15px !important;
            }
            
            .loading-subtitle {
                font-size: 1.2rem !important;
                margin-bottom: 30px !important;
            }
            
            .palm-trees {
                width: 250px !important;
                height: 150px !important;
            }
            
            .loading-bar-container {
                width: 90% !important;
                max-width: 300px !important;
                height: 25px !important;
            }
            
            .loading-percentage {
                font-size: 1.8rem !important;
            }
            
            .instructions {
                font-size: 1rem !important;
                padding: 0 15px !important;
                bottom: 10px !important;
            }
        }

        @media (max-height: 700px) {
            .loading-title {
                font-size: 1.8rem !important;
            }
            
            .palm-trees {
                transform: scale(0.8);
                margin: 15px auto !important;
            }
            
            .loading-bar-container {
                margin: 20px 0 !important;
            }
        }

        /* Ajustes espec√≠ficos para iPhone */
        @supports (-webkit-touch-callout: none) {
            .loading-screen {
                height: 100vh;
                height: -webkit-fill-available;
            }
        }

        .loading-title {
            font-size: 3rem;
            color: white;
            text-shadow: 3px 3px 0 #1A535C,
                         -2px -2px 0 #4ECDC4;
            margin-bottom: 20px;
            animation: pulse 2s infinite;
            word-break: break-word;
            line-height: 1.2;
        }

        .loading-subtitle {
            font-size: 1.5rem;
            color: #1A535C;
            margin-bottom: 40px;
            font-weight: bold;
            line-height: 1.3;
        }

        /* Gr√°fica animada de palmeras */
        .palm-trees {
            position: relative;
            width: 300px;
            height: 200px;
            margin: 30px auto;
            flex-shrink: 0;
        }

        .palm-trunk {
            position: absolute;
            bottom: 0;
            width: 15px;
            background: linear-gradient(to right, #8B4513, #A0522D);
            border-radius: 7px;
        }

        .trunk-1 { left: 50px; height: 100px; }
        .trunk-2 { left: 150px; height: 130px; }
        .trunk-3 { left: 250px; height: 90px; }

        .palm-leaves {
            position: absolute;
            width: 70px;
            height: 70px;
            background: linear-gradient(45deg, #2E8B57, #90EE90);
            border-radius: 0 50% 0 50%;
            transform-origin: bottom center;
            animation: sway 3s infinite ease-in-out;
        }

        .leaves-1 { left: 10px; top: 20px; animation-delay: 0s; }
        .leaves-2 { left: 110px; top: 0; animation-delay: 0.5s; }
        .leaves-3 { left: 210px; top: 40px; animation-delay: 1s; }

        /* Barra de carga */
        .loading-bar-container {
            width: 80%;
            max-width: 400px;
            height: 30px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 15px;
            overflow: hidden;
            margin: 30px 0;
            border: 3px solid #1A535C;
            flex-shrink: 0;
        }

        .loading-bar {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, #FF6B6B, #FFE66D, #4ECDC4, #1A535C);
            background-size: 300% 100%;
            animation: gradientBar 2s infinite linear;
            border-radius: 12px;
            transition: width 0.3s ease;
        }

        /* Porcentaje de carga */
        .loading-percentage {
            font-size: 2rem;
            font-weight: bold;
            color: #1A535C;
            margin-top: 10px;
            text-shadow: 2px 2px 0 white;
            flex-shrink: 0;
        }

        /* Instrucciones */
        .instructions {
            position: absolute;
            bottom: 20px;
            color: white;
            text-align: center;
            width: 100%;
            padding: 0 20px;
            font-size: 1.2rem;
            text-shadow: 1px 1px 2px #1A535C;
            animation: fadeInOut 3s infinite;
        }

        /* Escena AR */
        #ar-scene {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            height: -webkit-fill-available;
            opacity: 0;
            transition: opacity 1s ease;
            z-index: 999;
        }

        /* Asegurar que la escena A-Frame ocupe toda la pantalla */
        #ar-scene a-scene {
            width: 100% !important;
            height: 100% !important;
            position: absolute !important;
            top: 0 !important;
            left: 0 !important;
        }

        /* Animaciones */
        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        @keyframes sway {
            0%, 100% { transform: rotate(-5deg); }
            50% { transform: rotate(5deg); }
        }

        @keyframes gradientBar {
            0% { background-position: 0% 50%; }
            100% { background-position: 300% 50%; }
        }

        @keyframes fadeInOut {
            0%, 100% { opacity: 0.7; }
            50% { opacity: 1; }
        }

        /* Animaci√≥n de burbujas */
        .bubbles {
            position: absolute;
            width: 100%;
            height: 100%;
            pointer-events: none;
            top: 0;
            left: 0;
            z-index: 1;
        }

        .bubble {
            position: absolute;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            animation: floatUp 8s infinite ease-in;
        }

        @keyframes floatUp {
            0% {
                transform: translateY(100vh) scale(0);
                opacity: 1;
            }
            100% {
                transform: translateY(-100px) scale(1);
                opacity: 0;
            }
        }

        /* Scroll suave para contenido largo en m√≥viles peque√±os */
        .loading-content-container {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            padding: 10px;
        }

        /* Mensaje de orientaci√≥n para m√≥viles */
        .orientation-warning {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            color: white;
            z-index: 2000;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 20px;
            font-size: 1.5rem;
        }
        
        @media (max-height: 500px) and (orientation: landscape) {
            .orientation-warning {
                display: flex;
            }
            
            .loading-screen {
                display: none;
            }
        }
    </style>
</head>
<body>
    <!-- Advertencia de orientaci√≥n -->
    <div class="orientation-warning">
        <div>
            <h2>üå¥ Por favor gira tu dispositivo üì±</h2>
            <p>Para una mejor experiencia, usa el modo vertical (portrait)</p>
            <div style="font-size: 3rem; margin: 20px 0;">‚Üª</div>
        </div>
    </div>

    <!-- Pantalla de carga tropical -->
    <div class="loading-screen" id="loadingScreen">
        <div class="loading-content-container">
            <div class="loading-content">
                <h1 class="loading-title">üå¥ AR TROPICAL üå∫</h1>
                <p class="loading-subtitle">Cargando experiencia de Realidad Aumentada</p>
                
                <!-- Gr√°fica de palmeras -->
                <div class="palm-trees">
                    <div class="palm-trunk trunk-1"></div>
                    <div class="palm-trunk trunk-2"></div>
                    <div class="palm-trunk trunk-3"></div>
                    
                    <div class="palm-leaves leaves-1"></div>
                    <div class="palm-leaves leaves-2"></div>
                    <div class="palm-leaves leaves-3"></div>
                </div>
                
                <!-- Barra de carga -->
                <div class="loading-bar-container">
                    <div class="loading-bar" id="loadingBar"></div>
                </div>
                
                <!-- Porcentaje -->
                <div class="loading-percentage" id="loadingPercentage">0%</div>
                
                <!-- Instrucciones -->
                <p class="instructions">üîç Apunta la c√°mara al marcador para ver el video en AR</p>
            </div>
        </div>
        
        <!-- Burbujas decorativas -->
        <div class="bubbles" id="bubbles"></div>
    </div>

    <!-- Escena AR (oculta inicialmente) -->
    <div id="ar-scene">
        <a-scene mindar-image="imageTargetSrc: ./marker.mind;" vr-mode-ui="enabled: false" device-orientation-permission-ui="enabled: false" renderer="colorManagement: true; alpha: true;">
            <a-assets>
                <video id="ar-video" src="./asset.mp4" loop muted playsinline crossorigin="anonymous"></video>
            </a-assets>
            <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>
            <a-entity id="ar-target" mindar-image-target="targetIndex: 0">
                <a-plane
                    src="#ar-video"
                    position="0 0 0"
                    rotation="0 0 0"
                    height="1"
                    width="1.8076923076923077"
                ></a-plane>
            </a-entity>
        </a-scene>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Ajustar altura para m√≥viles iOS
            function setFullHeight() {
                const vh = window.innerHeight * 0.01;
                document.documentElement.style.setProperty('--vh', `${vh}px`);
                
                // Aplicar altura completa a pantalla de carga
                const loadingScreen = document.getElementById('loadingScreen');
                loadingScreen.style.height = window.innerHeight + 'px';
            }
            
            // Llamar al cargar y al redimensionar
            setFullHeight();
            window.addEventListener('resize', setFullHeight);
            window.addEventListener('orientationchange', setFullHeight);
            
            // Elementos DOM
            const loadingScreen = document.getElementById('loadingScreen');
            const loadingBar = document.getElementById('loadingBar');
            const loadingPercentage = document.getElementById('loadingPercentage');
            const arScene = document.getElementById('ar-scene');
            const bubblesContainer = document.getElementById('bubbles');
            
            // Crear burbujas decorativas
            function createBubbles() {
                // Limpiar burbujas existentes
                bubblesContainer.innerHTML = '';
                
                const bubbleCount = window.innerWidth < 768 ? 15 : 25;
                
                for (let i = 0; i < bubbleCount; i++) {
                    const bubble = document.createElement('div');
                    bubble.className = 'bubble';
                    
                    // Tama√±o proporcional al dispositivo
                    const baseSize = window.innerWidth < 768 ? 40 : 60;
                    const size = Math.random() * baseSize + 15;
                    bubble.style.width = `${size}px`;
                    bubble.style.height = `${size}px`;
                    
                    // Posici√≥n aleatoria
                    bubble.style.left = `${Math.random() * 100}%`;
                    
                    // Retraso de animaci√≥n aleatorio
                    bubble.style.animationDelay = `${Math.random() * 5}s`;
                    
                    // Color aleatorio de la paleta tropical
                    const colors = [
                        'rgba(255, 107, 107, 0.4)',
                        'rgba(255, 230, 109, 0.4)',
                        'rgba(78, 205, 196, 0.4)',
                        'rgba(26, 83, 92, 0.4)'
                    ];
                    bubble.style.background = colors[Math.floor(Math.random() * colors.length)];
                    
                    bubblesContainer.appendChild(bubble);
                }
            }
            
            // Inicializar burbujas
            createBubbles();
            
            // Recrear burbujas al cambiar tama√±o
            window.addEventListener('resize', createBubbles);
            
            // Simular progreso de carga
            let progress = 0;
            const loadingInterval = setInterval(() => {
                progress += Math.random() * 15 + 5;
                if (progress > 100) progress = 100;
                
                loadingBar.style.width = `${progress}%`;
                loadingPercentage.textContent = `${Math.round(progress)}%`;
                
                if (progress >= 100) {
                    clearInterval(loadingInterval);
                    
                    // Esperar un momento y luego ocultar pantalla de carga
                    setTimeout(() => {
                        loadingScreen.style.opacity = '0';
                        
                        setTimeout(() => {
                            loadingScreen.style.display = 'none';
                            arScene.style.opacity = '1';
                            
                            // Inicializar eventos AR despu√©s de mostrar la escena
                            const arTarget = document.querySelector('#ar-target');
                            const video = document.querySelector('#ar-video');
                            
                            if (arTarget && video) {
                                arTarget.addEventListener('targetFound', () => { 
                                    video.play().catch(e => console.error("Error al reproducir video", e)); 
                                });
                                arTarget.addEventListener('targetLost', () => { 
                                    video.pause(); 
                                });
                            }
                        }, 1000);
                    }, 800);
                }
            }, 200);
            
            // Crear m√°s burbujas peri√≥dicamente
            setInterval(() => {
                if (loadingScreen.style.display !== 'none') {
                    const bubble = document.createElement('div');
                    bubble.className = 'bubble';
                    
                    const baseSize = window.innerWidth < 768 ? 30 : 50;
                    const size = Math.random() * baseSize + 10;
                    bubble.style.width = `${size}px`;
                    bubble.style.height = `${size}px`;
                    bubble.style.left = `${Math.random() * 100}%`;
                    
                    const colors = ['rgba(255, 255, 255, 0.3)', 'rgba(255, 230, 109, 0.3)'];
                    bubble.style.background = colors[Math.floor(Math.random() * colors.length)];
                    
                    bubblesContainer.appendChild(bubble);
                    
                    // Remover burbuja despu√©s de animaci√≥n
                    setTimeout(() => {
                        if (bubble.parentNode) {
                            bubble.parentNode.removeChild(bubble);
                        }
                    }, 8000);
                }
            }, 1500);
        });
    </script>
</body>
</html>
